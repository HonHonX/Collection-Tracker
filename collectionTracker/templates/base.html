<!DOCTYPE html>
    <html lang="en">
        <head> 
            <meta charset="UTF-8">
            <meta name="viewport" content="width=device-width, initial-scale=1.0">
            <title>
                {% block title %}
                    Collection Tracker
                {% endblock %}
            </title>
            {% load static %}
            {% if request.user.userprofile.color_scheme == 'spring' %}
                <link rel="stylesheet" href="{% static 'css/themes/spring_theme.css' %}">
            {% elif request.user.userprofile.color_scheme == 'summer' %}
                <link rel="stylesheet" href="{% static 'css/themes/summer_theme.css' %}">
            {% elif request.user.userprofile.color_scheme == 'autumn' %}
                <link rel="stylesheet" href="{% static 'css/themes/autumn_theme.css' %}">
            {% else %}
                <link rel="stylesheet" href="{% static 'css/themes/winter_theme.css' %}">
            {% endif %}
            <link rel="stylesheet" href="{% static 'css/main.css' %}">
            <link rel="icon" href="{% static 'img/favicon.ico' %}" type="image/x-icon">
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css"><!-- Sweet Alert 2 Notification-->
            <link rel="stylesheet" href="{% static 'css/components/notification.css' %}" type="text/css"> <!-- Sweet Alert 2 Custom Design fit to Web Application Dark Mode Theme -->
            {% block extra_css %}
                <!-- Opportunity to add more stylesheets specific to the page -->
            {% endblock %}
        </head>

        <body>
            <main>
                {% block content %}
                <!-- Child templates will replace this block -->
                {% endblock %}
                <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script><!-- Sweet Alert 2 Notification -->
                <script>
                    document.addEventListener('DOMContentLoaded', function() {
                        fetch('/stats/notifications/')
                            .then(response => response.json())
                            .then(data => {
                                if (data.notifications && data.notifications.length > 0) {
                                    console.log('Notifications fetched:', data.notifications);
                                    let showNotification = (index) => {
                                        if (index < data.notifications.length) {
                                            let notification = data.notifications[index];
                                            Swal.fire({
                                                title: 'Congratulations!',
                                                text: notification.message,
                                                imageUrl: notification.badge_image_url,
                                                imageWidth: 100,
                                                imageHeight: 100,
                                                timer: 3000,
                                                timerProgressBar: true,
                                                showConfirmButton: false,
                                            }).then(() => {
                                                console.log('Deleting notification:', notification.id);
                                                fetch(`/stats/delete_notification/${notification.id}/`, {
                                                    method: 'DELETE',
                                                    headers: {
                                                        'X-CSRFToken': '{{ csrf_token }}',
                                                        'Content-Type': 'application/json'
                                                    }
                                                }).then(response => {
                                                    if (!response.ok) {
                                                        console.error('Failed to delete notification:', notification.id);
                                                    } else {
                                                        console.log('Notification deleted:', notification.id);
                                                    }
                                                    showNotification(index + 1);
                                                });
                                            });
                                        }
                                    };
                                    showNotification(0);
                                } else {
                                    console.log('No notifications to show.');
                                }
                            })
                            .catch(error => {
                                console.error('Error fetching notifications:', error);
                            });
                    });
                </script>
                {% block js %}
                    <!-- Opportunity to add Java Script to the page -->
                {% endblock %} 
            <!--    <footer class="footer">
                    <p>&copy; 2025 Beats & Bops | Sharon Buch, Janine Reidenbach, Marius Maurer, Marlon Schmidt</p>
                    </footer> -->
            </main>
                
        </body>
</html>
