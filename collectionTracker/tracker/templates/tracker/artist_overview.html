<!-- artist_overview.html -->
{% extends 'base_with_sidebar.html' %}
{% load static %}

{% block title %}
    Artist Overview - {{ artist_name }}
{% endblock %}

{% block site_specific_css %}
    <link rel="stylesheet" href="{% static 'tracker/css/tracker.css' %}" type="text/css">
{% endblock %}

{% block maincontent %}

    {% if error %}
        <p>{{ error }}</p>
    {% else %}
        <div class="artist-detail">
            {% if artist_photo_url %}
                <img src="{{ artist_photo_url }}" alt="{{ artist_name }}'s photo">
            {% endif %}

            <h1>{{ artist_name }}</h1>
            {% if artist_info.genres %}
                <p>Genres: {{ artist_info.genres|join:", " }}</p>
            {% endif %}

            <p>Popularity: {{ artist_info.popularity }}</p>
            <p>Total Albums: {{ artist_info.total_albums }}</p>

        </div>

        <div class="album-overview">
            <div class="sticky-top">
                <div class="latest-release">
                    <iframe src="https://open.spotify.com/embed/album/{{ latest_album.id }}"
                    class="spotify-player" frameborder="0" allowtransparency="true" allow="encrypted-media"></iframe>
                </div>

                <div class="sorting-controls">
                    <label for="album-type-filter">Filter by Album Type:</label>
                    <select id="album-type-filter">
                        <option value="">All Types</option>
                        <option value="Album">Album</option>
                        <option value="Single">Single</option>
                    </select>
                    
                    <label for="sort-criteria">Sort by:</label>
                    <select id="sort-criteria">
                        <option value="release_date">Release Date</option>
                    </select>
                    <img id="sort-toggle" class="sort-icon" 
                        src="{% static 'icons/sort-asc.svg' %}" 
                        alt="Sort toggle" 
                        data-sort-order="asc">
                </div>

                <div class="gradient-box"></div>
            </div>
            <div class="album-grid">
                {% for album in albums %}
                <div class="album-item" 
                    data-album-id="{{ album.spotify_id }}" 
                    data-album-name="{{ album.name }}"
                    data-album-type="{{ album.album_type }}" data-release-date="{{ album.release_date }}"
                    data-image-url="{{ album.image_url }}"
                    data-artist-name="{{ artist_name }}"
                    data-in-collection="{% if album.spotify_id in user_album_ids %}true{% else %}false{% endif %}"
                    data-in-wishlist="{% if album.spotify_id in user_wishlist_ids %}true{% else %}false{% endif %}">
                    <div class="album-controls">
                        <img id="wishlist-control-icon" class="icon" src="{% static 'icons/wishlist_add.svg' %}" alt="Edit wishlist status" data-action="add_to_wishlist">
                        <img id="control-icon" class="icon" src="{% static 'icons/add.svg' %}" alt="Add/Remove">
                    </div>

                    {% if album.image_url %}
                    <img src="{{ album.image_url }}" alt="Album cover" class="album-cover">
                    {% endif %}
                    <div class="album-info">
                        {{ album.album_type }} <br>
                        <strong>{{ album.name }} <br></strong>
                        {{ album.release_date }} <br>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    {% endif %}
{% endblock %}

{% block js %}
    <script src="{% static 'js/manageCollection.js' %}"></script>
    <script src="{% static 'js/manageWishlist.js' %}"></script>
    <script src="{% static 'js/sortAlbums.js' %}"></script>
    <script src="{% static 'js/filterByAlbumType.js' %}"></script>
{% endblock %}
